{% extends "homepage/layout.html" %}

{% load homepage_extras %}
{% load membrane_extras %}

{% block title %}Topologies{% endblock %}

{% block content %}
    <br>
    <h1>Membranes</h1>
    <br>
    <div class="container">
       <div class="row align-items-center bg-white border rounded border-success p-3">
            <div class="col-7">
                <table class="table table-sm">
                    <tbody>
                        <tr><td class="font-weight-bold">Name:</td><td>{{ membranetopol.name }}</td></tr> 
                        <tr>
                            <td class="font-weight-bold">Lipids:</td>
                            <td>
                                {% lipidnames membranetopol.topolcomposition_set.all as lipids %}
                                {% for lip in lipids %}
                                    <a class="text-success" href={% url 'lipdetail' lip.slug %}>{{ lip.name }}{% if not forloop.last %},{% endif %}</a>
                                {% endfor %}             
                            </td>
                        </tr> 
                        <tr>
                            <td class="font-weight-bold">Forcefield:</td>
                            <td><a class="text-success" href="{% url 'fflist' %}?ffid={{ membranetopol.forcefield.pk }}">{{ membranetopol.forcefield }}</a></td>
                        </tr>  
                        <tr><td class="font-weight-bold">Software:</td><td>{{ membranetopol.get_software_display }}</td></tr> 
                        <tr>
                            <td class="font-weight-bold">Files:</td>
                            <td>
                                <a href="{{ membranetopol.mem_file.url }}" class="text-success" target="blank">{{ membranetopol.mem_file.url|basename }}</a>, 
                                <a href="{{ membranetopol.compo_file.url }}" class="text-success" target="blank">{{ membranetopol.compo_file.url|basename }}</a><br>
                                <a href="{% url 'getfiles' %}?memid={{ membranetopol.pk }}" class="text-success">Simulation files<a/>
                            </td>
                        </tr>  
                        <tr><td class="font-weight-bold">Number:</td><td>{{ membranetopol.nb_lipids }} lipids</td></tr> 
                        <tr><td class="font-weight-bold">Temperature:</td><td>{{ membranetopol.temperature }} Â°K</td></tr> 
                        <tr><td class="font-weight-bold">Equilibration:</td><td>{{ membranetopol.equilibration }} ns</td></tr> 
                        <tr><td class="font-weight-bold">Tags:</td><td>{{ membranetopol.membrane.tag.all|join:", " }}</td></tr> 
                        <tr>
                            <td><strong>Description:</strong></td> 
                            <td>{{ membranetopol.description }}</td> 
                        </tr>  
                        <tr>
                            <td><strong>References:</strong></td> 
                            <td>
                                {% for reference in membranetopol.reference.all %}
                                    <a class="text-success" href="http://dx.doi.org/{{ reference.doi }}">{{ reference.refid }}</a>
                                    <i>{{ reference.journal }}</i>, {{ reference.volume }}.
                                    {{ reference.title }}<br>
                                {% endfor %}
                            </td> 
                        </tr>  
                    </tbody>
                </table>
            </div>
            <div class="col-5">
                <!--<img style="max-height:520px;max-width:500px;"width:30%>-->
                <div id="viewport" style="width:300px; height:400px; margin: 0 auto;"></div>
            </div>
        </div>
        <div class="row align-items-center bg-white border rounded border-success p-3">
            <div class="col">
                <table class="table table-sm">
                    <tbody>
                        <tr>
                            <td class="font-weight-bold">Composition:</td>
                            <td>
                                    <div class="row">
                                        <div class="col-5 font-weight-bold font-italic">Lower leaflet</div>
                                        <div class="col-5 font-weight-bold font-italic">Upper leaflet</div>
                                    </div>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>
                                    <div class="row">
                                        <div class="col-5">
                                            {% for lipid in membranetopol.topolcomposition_set.all|dictsortreversed:"number" %}
                                                {% if lipid.side == "LO" %}
                                                    {{lipid.number}}
                                                    <a class="text-success" href={% url 'lipdetail' lipid.topology.lipid.slug %}>{{lipid.topology.lipid.name}}</a>
                                                    (<a class="text-success" href="{% url 'toplist' %}?topid={{lipid.topology.pk}}">{{lipid.topology.version}}</a>)<br> 
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                        <div class="col-5">
                                            {% for lipid in membranetopol.topolcomposition_set.all|dictsortreversed:"number" %}
                                                {% if lipid.side == "UP" %}
                                                    {{lipid.number}}
                                                    <a class="text-success" href={% url 'lipdetail' lipid.topology.lipid.slug %}>{{lipid.topology.lipid.name}}</a>
                                                    (<a class="text-success" href="{% url 'toplist' %}?topid={{lipid.topology.pk}}">{{lipid.topology.version}}</a>)<br>
                                                {% endif %}
                                            {% endfor %}
                                        </div>
                                    </div>
                            </td>
                        </tr>  
                    </tbody>
                </table>
            </div>
        </div>
        <div class="row align-items-center bg-white border rounded border-success p-3">
            <div class="col-7">
                {% if user.is_authenticated %}
                    <p>
                        {% if user == membranetopol.curator %}
                            <a href={% url 'memupdate' membranetopol.pk %}><i class="fas fa-edit text-success" aria-hidden="true"></i></a>&nbsp
                            <a href={% url 'memdelete' membranetopol.pk %}><i class="fas fa-trash text-success" aria-hidden="true"></i></a>
                        {% else %}
                            <a href={% url 'mail' %}?lipid={{ membranetopol.pk }}><i class="fas fa-edit text-success" aria-hidden="true"></i></a>
                        {% endif %}
                    </p>
                {% endif %}
            </div>
            <div class="col-5 text-right">
                <b>Curator:</b> 
                <a class="text-success" href={% url 'userdetail' membranetopol.curator.pk %}>{{ membranetopol.curator.get_full_name }}</a> on {{ membranetopol.date }}
            </div>
        </div>
    </div>
    <br>
{% endblock %}

{% block script %}
    <script>
        var name = "{{ membranetopol.mem_file.url|basename }}"; 
        var data = "../..{{ membranetopol.mem_file.url|dirname }}/"; 
        NGL.DatasourceRegistry.add("data", new NGL.StaticDatasource(data))
        var stage;
        document.addEventListener("DOMContentLoaded", function () {
            stage = new NGL.Stage('viewport')
            // Handle window resizing
            window.addEventListener( "resize", function( event ){
                stage.handleResize();
            }, false );
            stage.loadFile("data://"+name).then(function (o) {
                o.addRepresentation("licorice")
                o.autoView()
            })
        })
    </script>
{% endblock %}



